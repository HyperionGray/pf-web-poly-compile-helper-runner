# Developer Navigation Guide

## Quick Reference for Large Files

This guide helps developers navigate the larger files in the codebase efficiently.

## Core Parser Files

### pf_grammar.py (3,558 lines)
**Status:** ⚠️ Auto-generated by Lark v1.3.0 - **DO NOT EDIT MANUALLY**

This file contains the complete grammar specification for the PF DSL. It is generated from `pf-runner/pf.lark` using the Lark parser generator.

**To modify the grammar:**
1. Edit `pf-runner/pf.lark`
2. Regenerate this file using Lark's standalone generator
3. Never manually edit `pf_grammar.py`

**Key sections:**
- Lines 1-100: Lark framework imports and base classes
- Lines 100-2000: Grammar rules and terminals
- Lines 2000-3000: Parser implementation
- Lines 3000+: Parse tree visitors and transformers

---

### pf_parser.py (1,514 lines)
**Main parser implementation for PF DSL**

**File Organization:**
```
Lines 1-100:    Imports, configuration, exceptions
Lines 100-126:  Pfyfile discovery and loading
Lines 127-145:  Variable interpolation
Lines 147-640:  Polyglot shell helpers (40+ languages)
                - Python, JavaScript, Ruby, Go, Rust, etc.
                - Each language has dedicated execution logic
Lines 641-937:  DSL parsing (task definitions)
                - Task parsing: parse_pfyfile_text()
                - Include handling
                - Describe directive processing
Lines 939-981:  SSH host management
                - Host parsing and validation
                - Environment resolution
Lines 983-1219: Fabric-based executors
                - Remote execution
                - Parallel host execution
                - Output formatting
Lines 1221-1247: Built-in tasks
Lines 1249+:    CLI interface and main()
```

**Key Functions:**
- `parse_pfyfile_text()` - Main parsing entry point
- `execute_task()` - Task execution logic
- `_exec_dsl_cmd()` - Command execution dispatcher
- `main()` - CLI entry point

**Navigation Tips:**
```bash
# Jump to specific sections
grep -n "^# ----------" pf_parser.py

# Find specific function
grep -n "^def function_name" pf_parser.py

# List all functions
grep -n "^def " pf_parser.py
```

---

### pf_tui.py (1,279 lines)
**Interactive Terminal User Interface**

**File Organization:**
```
Lines 1-72:     Imports and configuration
Lines 73-93:    Data classes (TaskCategory, PfyFile)
Lines 95-200:   PfTUI class initialization
                - Color scheme setup
                - Console configuration
Lines 201-400:  File discovery and task loading
                - Pfyfile scanning
                - Task parsing and categorization
Lines 401-700:  Task browser UI
                - Category display
                - Task listing
                - Navigation handling
Lines 701-1000: Task execution
                - Output display
                - Progress tracking
                - Error handling
Lines 1001-1200: Debugging integration
                - Syntax validation
                - Error reporting
Lines 1201-1268: Keyboard event handlers
Lines 1268+:    Main entry point
```

**Key Classes and Methods:**
- `PfTUI` - Main TUI controller
  - `__init__()` - Setup and initialization
  - `discover_pfyfiles()` - Find all Pfyfile.pf files
  - `load_tasks()` - Parse and categorize tasks
  - `show_task_browser()` - Display interactive browser
  - `run_task()` - Execute selected task
  - `show_debugger()` - Debugging interface

**Navigation Tips:**
```bash
# List all methods
grep -n "    def " pf_tui.py

# Find specific method
grep -n "def method_name" pf_tui.py

# Show class structure
grep -n "^class\|    def " pf_tui.py
```

---

### pf_containerize.py (1,267 lines)
**Container orchestration and build management**

**File Organization:**
```
Lines 1-67:     Imports and configuration
Lines 68-234:   Data classes and enums
                - ProjectLanguage, BuildSystem
                - ProjectProfile, RetryConfig
                - Error pattern registration
Lines 235-651:  ProjectDetector class
                - Language detection
                - Build system detection
                - Dependency analysis
                - Multi-language support
Lines 652-786:  DockerfileGenerator class
                - Base image selection
                - Build instruction generation
                - Optimization strategies
Lines 787-877:  QuadletGenerator class
                - Systemd quadlet file generation
                - Service configuration
Lines 878-1032: ContainerBuilder class
                - Build execution
                - Error handling and retry logic
                - Output parsing
Lines 1033+:    Public API functions
                - containerize()
                - generate_dockerfile_only()
                - generate_quadlet_files()
```

**Key Classes:**
- `ProjectDetector` - Analyzes project structure and detects languages/frameworks
- `DockerfileGenerator` - Creates optimized Dockerfiles
- `QuadletGenerator` - Generates systemd quadlet configurations
- `ContainerBuilder` - Manages build process with retry logic

**Navigation Tips:**
```bash
# List all classes
grep -n "^class " pf_containerize.py

# List methods of specific class
awk '/^class ClassName:/,/^class / {print NR": "$0}' pf_containerize.py

# Find specific error handler
grep -n "_fix_.*" pf_containerize.py
```

---

### pf_prune.py (625 lines)
**Cleanup and maintenance utilities**

**File Organization:**
```
Lines 1-100:    Imports and configuration
Lines 101-300:  Container cleanup functions
                - Stopped container removal
                - Dangling image pruning
                - Volume cleanup
Lines 301-450:  System-wide cleanup
                - Build cache management
                - Network cleanup
                - Comprehensive system prune
Lines 451-550:  Safety and confirmation logic
                - Dry-run mode
                - User confirmation
                - Backup/rollback support
Lines 551+:     CLI interface
```

**Key Functions:**
- `prune_containers()` - Remove stopped containers
- `prune_images()` - Clean up unused images
- `prune_volumes()` - Remove unused volumes
- `system_prune()` - Comprehensive cleanup
- `safe_prune()` - Cleanup with confirmations

---

### pf_main.py (621 lines)
**Main application entry point**

**File Organization:**
```
Lines 1-100:    Imports and setup
Lines 101-300:  Argument parsing
                - Subcommand definitions
                - Parameter handling
                - Help system
Lines 301-450:  Configuration management
                - Environment variables
                - Config file loading
                - Default values
Lines 451-550:  Command dispatching
                - Route to appropriate handlers
                - Error handling
Lines 551+:     Main entry point
```

**Key Functions:**
- `parse_args()` - Command-line argument processing
- `load_config()` - Configuration loading
- `dispatch_command()` - Route to subcommands
- `main()` - Application entry point

---

## Fuzzing Tools

### in_memory_fuzzer.py (564 lines)
**Security testing framework**

**File Organization:**
```
Lines 1-100:    Imports and configuration
Lines 101-250:  Input generation
                - Mutation strategies
                - Random input generation
                - Coverage-guided fuzzing
Lines 251-400:  Fuzzing engine
                - Test case execution
                - Crash detection
                - Coverage tracking
Lines 401-500:  Reporting
                - Results aggregation
                - Statistics generation
                - Output formatting
Lines 501+:     CLI interface
```

**Key Classes:**
- `InputGenerator` - Creates test inputs
- `FuzzingEngine` - Executes fuzzing campaigns
- `CrashDetector` - Identifies crashes and hangs
- `CoverageTracker` - Monitors code coverage

---

## External Dependencies

### fabric/connection.py (1,115 lines)
**Status:** ⚠️ Third-party library - **DO NOT MODIFY**

This is part of the bundled Fabric library for SSH connections and remote execution. Any needed changes should be contributed upstream to the Fabric project.

### fabric/testing/base.py (543 lines)
**Status:** ⚠️ Third-party library - **DO NOT MODIFY**

Part of Fabric's testing framework. Do not modify directly.

---

## IDE Navigation Tips

### VS Code
```json
// Add to .vscode/settings.json for better navigation
{
  "breadcrumbs.enabled": true,
  "outline.showFunctions": true,
  "outline.showClasses": true,
  "editor.codeLens": true
}
```

**Shortcuts:**
- `Ctrl+Shift+O` - Go to symbol in file
- `Ctrl+T` - Go to symbol in workspace
- `Ctrl+P` - Quick file open
- `Ctrl+G` - Go to line number

### Vim/Neovim
```vim
" Navigate by sections
/^# ----------
" Jump to next function
/^def 
" Jump to next class
/^class 
" Use ctags for better navigation
:!ctags -R .
:tag function_name
```

### PyCharm
- `Ctrl+F12` - File structure
- `Ctrl+Alt+Shift+N` - Go to symbol
- `Alt+7` - Structure view
- `Ctrl+H` - Type hierarchy

---

## Code Analysis Commands

### Quick Statistics
```bash
# Count functions in a file
grep -c "^def " pf_parser.py

# Count classes
grep -c "^class " pf_containerize.py

# Show file complexity
python -m radon cc pf_parser.py -s

# Show maintainability index
python -m radon mi pf_parser.py
```

### Find Specific Patterns
```bash
# Find all TODOs
grep -rn "TODO\|FIXME\|XXX" pf-runner/

# Find error handling
grep -n "except\|raise" pf_parser.py

# Find all public functions
grep -n "^def [^_]" pf_parser.py
```

### Generate Documentation
```bash
# Generate HTML docs with pydoc
python -m pydoc -w pf_parser

# Generate call graph (requires pycallgraph)
pycallgraph graphviz -- pf_parser.py

# Create function index
ctags -R --fields=+iaS --extra=+q
```

---

## Understanding the Architecture

### Component Relationships

```
pf_main.py (CLI Entry)
    ↓
pf_parser.py (Core Logic)
    ↓
├─→ pf_grammar.py (Grammar Rules)
├─→ pf_shell.py (Shell Execution)
├─→ pf_containerize.py (Container Management)
├─→ pf_prune.py (Cleanup)
└─→ pf_tui.py (Interactive UI)

Tools:
├─→ in_memory_fuzzer.py (Security Testing)
└─→ [other tools]

External:
└─→ fabric/ (SSH/Remote Execution)
```

### Data Flow

1. **Parse Phase:**
   - `pf_main.py` receives CLI arguments
   - `pf_parser.py` loads and parses Pfyfile.pf
   - `pf_grammar.py` validates syntax

2. **Execution Phase:**
   - `pf_parser.py` coordinates task execution
   - `pf_shell.py` handles shell commands
   - `pf_containerize.py` manages containers
   - `fabric/` handles remote connections

3. **UI Phase:**
   - `pf_tui.py` provides interactive interface
   - Displays tasks, runs selections
   - Shows live output and progress

---

## Best Practices for Contributing

### Before Editing Large Files

1. **Read the file header** - Contains structure overview
2. **Use navigation markers** - Jump to relevant sections
3. **Understand dependencies** - Check what functions call what
4. **Run tests** - Ensure changes don't break functionality
5. **Add tests** - Cover new functionality

### When Adding Features

1. **Find the right section** - Use existing organization
2. **Follow naming conventions** - Match existing style
3. **Add docstrings** - Document new functions/classes
4. **Update this guide** - Keep navigation info current

### Code Review Checklist

- [ ] Changes are in appropriate section
- [ ] New functions have docstrings
- [ ] Tests added/updated
- [ ] No unnecessary changes to unrelated code
- [ ] Navigation markers updated if needed
- [ ] Documentation updated

---

## Additional Resources

- [CODE_QUALITY_ANALYSIS.md](../CODE_QUALITY_ANALYSIS.md) - Detailed quality analysis
- [CODE_CLEANLINESS_REVIEW_RESPONSE.md](../CODE_CLEANLINESS_REVIEW_RESPONSE.md) - Review response
- [ARCHITECTURE.md](../pf-runner/ARCHITECTURE.md) - System architecture
- [CONTRIBUTING.md](../CONTRIBUTING.md) - Contribution guidelines

---

**Last Updated:** 2025-12-29  
**Maintainer:** Development Team
